<!DOCTYPE html>
<html lang="en">
<head>
  <%- include('partials/head.ejs') %>
  <title>Search Recipes</title>
</head>

<body>
  <%- include('partials/nav.ejs') %>

  <main class="container mt-4 mb-5" style="max-width: 1100px;">
    <!-- Search header -->
    <h1 class="h3 mb-3">Search Recipes</h1>

    <form class="row g-2 mb-4" method="GET" action="/recipes">
      <div class="col-md-9">
        <input
          type="text"
          name="keyword"
          class="form-control"
          placeholder="Search by ingredients (e.g. chicken, rice)"
          value="<%= typeof keyword !== 'undefined' ? keyword : '' %>"
        >
      </div>
      <div class="col-md-3 d-grid">
        <button class="btn btn-success" type="submit">Search</button>
      </div>
    </form>

    <% if (!meals || !meals.length) { %>
      <p class="text-muted">
        No recipes found. Try a different ingredient or combination of ingredients.
      </p>
    <% } else { %>
      <!-- Card grid -->
      <div class="row row-cols-1 row-cols-md-3 g-4">
        <% meals.forEach(meal => { %>
          <div class="col">
            <div class="card h-100 shadow-sm">
              <img
                src="<%= meal.strMealThumb %>"
                alt="<%= meal.strMeal %>"
                class="card-img-top"
                style="height: 200px; object-fit: cover;"
              >
              <div class="card-body d-flex flex-column">
                <h5 class="card-title"><%= meal.strMeal %></h5>

                <p class="card-text mb-1 small text-muted">Top ingredients</p>
                <ul class="small mb-3">
                  <% 
                    // Show up to ~6 ingredients from TheMealDB data
                    for (let i = 1; i <= 20; i++) {
                      const ing = meal['strIngredient' + i];
                      const meas = meal['strMeasure' + i];
                      if (!ing || (typeof ing === 'string' && ing.trim() === '')) continue;
                  %>
                    <li><%= (meas || '').trim() %> <%= ing %></li>
                  <% 
                      // stop early after a few for brevity
                      if (i >= 6) break;
                    } 
                  %>
                </ul>

                <div class="mt-auto d-flex justify-content-between">
                  <% if (meal.strYoutube) { %>
                    <a
                      href="<%= meal.strYoutube %>"
                      target="_blank"
                      rel="noopener"
                      class="btn btn-sm btn-outline-success"
                    >
                      YouTube
                    </a>
                  <% } %>

                  <% if (meal.strSource) { %>
                    <a
                      href="<%= meal.strSource %>"
                      target="_blank"
                      rel="noopener"
                      class="btn btn-sm btn-outline-secondary"
                    >
                      Source
                    </a>
                  <% } %>
                </div>
              </div>
            </div>
          </div>
        <% }) %>
      </div>
    <% } %>
  </main>

  <%- include('partials/foot.ejs') %>
</body>
</html>
