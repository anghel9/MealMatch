<!DOCTYPE html>
<html lang="en">
<head>
  <%- include('partials/head.ejs') %>
  <title><%= profileUser.username %> — Profile</title>
</head>
<body>
  <%- include('partials/nav.ejs') %>

  <div class="container mt-4" style="max-width: 720px;">
    <div class="card shadow-sm mb-3">
      <div class="card-body">
        <h3 class="card-title mb-1"><%= profileUser.username %></h3>

        <% if (profileUser.createdAt) { %>
          <small class="text-muted">Member since 
            <%= new Date(profileUser.createdAt).toLocaleDateString() %>
          </small>
        <% } %>

        <% if (profileUser.bio) { %>
          <p class="mt-3 mb-0"><%= profileUser.bio %></p>
        <% } else { %>
          <p class="mt-3 mb-0 text-muted">
            <% if (isOwnProfile) { %>
              You haven’t added a bio yet. Use “Edit profile” to tell others about your goals.
            <% } else { %>
              This user hasn’t added a bio.
            <% } %>
          </p>
        <% } %>

        <% if (isOwnProfile) { %>
          <div class="mt-3">
            <a href="/profile/edit" class="btn btn-outline-secondary btn-sm">Edit profile</a>
          </div>
        <% } %>
      </div>
    </div>

    <!-- Stats -->
    <div class="row g-3 mb-3">
      <div class="col-md-4">
        <div class="card p-3 text-center shadow-sm">
          <div>Total favorites</div>
          <h4><%= stats.favoritesCount %></h4>
        </div>
      </div>
      <div class="col-md-4">
        <div class="card p-3 text-center shadow-sm">
          <div>Meals logged</div>
          <h4><%= stats.entriesCount %></h4>
        </div>
      </div>
      <% if (isOwnProfile && stats.todayTotals) { %>
        <div class="col-md-4">
          <div class="card p-3 text-center shadow-sm">
            <div>Today’s calories</div>
            <h4><%= stats.todayTotals.calories %></h4>
          </div>
        </div>
      <% } %>
    </div>

    <% if (!isOwnProfile && Array.isArray(recentFavorites) && recentFavorites.length) { %>
      <h5 class="mb-2">Recent favorites</h5>
      <ul class="list-group shadow-sm mb-4">
        <% recentFavorites.forEach(f => { %>
          <li class="list-group-item d-flex align-items-center">
            <% if (f.imageUrl) { %>
              <img src="<%= f.imageUrl %>" class="rounded me-3"
                   style="width:48px;height:48px;object-fit:cover;">
            <% } %>
            <div class="flex-grow-1">
              <div><%= f.title %></div>
              <small class="text-muted">
                <% if (f.calories != null) { %>Calories: <%= f.calories %><% } %>
                <% if (f.protein != null)  { %> · Protein: <%= f.protein %> g<% } %>
              </small>
            </div>
          </li>
        <% }) %>
      </ul>
    <% } %>
  </div>

  <%- include('partials/foot.ejs') %>
</body>
</html>
